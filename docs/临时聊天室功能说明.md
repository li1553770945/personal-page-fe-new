# 临时聊天室功能说明

## 功能概述

临时聊天室是一个实时通讯功能，支持：
- 创建临时聊天室
- 通过房间ID加入聊天室
- 发送文本消息
- 发送文件（支持文件上传和下载）
- 分享聊天室链接
- 多语言支持（中文/英文）

## 技术架构

### 前端技术栈
- **React**: UI框架
- **Next.js**: 应用框架
- **Zustand**: 状态管理
- **WebSocket**: 实时通讯
- **shadcn UI**: UI组件库
- **Tailwind CSS**: 样式
- **i18next**: 国际化

### 核心文件结构

```
app/chat/page.tsx                          # 聊天室主页面
store/chatStore.ts                         # 聊天室状态管理
types/chat.ts                              # TypeScript类型定义
components/chat/
  ├── header-room-controls.tsx            # 房间控制组件
  ├── message-display.tsx                 # 消息展示组件
  └── message-input.tsx                   # 消息输入组件
```

## 使用说明

### 环境配置

1. 复制 `.env.example` 到 `.env.local`
2. 配置 WebSocket 服务器地址：
   ```
   NEXT_PUBLIC_WS_URL=ws://your-websocket-server:port
   ```

### API 接口要求

后端需要提供以下接口：

#### 1. 创建房间
```
POST /api/rooms
Response: {
  code: 0,
  data: {
    roomId: string,
    clientId: string
  }
}
```

#### 2. 加入房间
```
POST /api/rooms/join/?roomId={roomId}
Response: {
  code: 0,
  data: {
    clientId: string
  }
}
```

#### 3. 上传文件
```
POST /api/files
Body: {
  name: string,
  key: string,
  maxDownload: number
}
Response: {
  code: 0,
  data: {
    signedUrl: string,
    key: string
  }
}
```

#### 4. 下载文件
```
GET /api/files/download?key={key}
Response: {
  code: 0,
  data: {
    signedUrl: string
  }
}
```

### WebSocket 协议

#### 连接
```
ws://your-server/ws?roomId={roomId}
```

#### 消息格式

**文本消息**
```json
{
  "type": "text",
  "content": "消息内容"
}
```

**文件消息**
```json
{
  "type": "file",
  "fileInfo": {
    "key": "文件key",
    "name": "文件名",
    "size": 文件大小(字节)
  }
}
```

## 功能使用流程

### 创建聊天室
1. 访问 `/chat` 页面
2. 点击"创建聊天室"按钮
3. 系统自动创建房间并连接
4. 可以点击"分享聊天室"按钮获取分享链接

### 加入聊天室
1. 在输入框中输入房间ID
2. 点击"加入"按钮
3. 或直接访问带有 `chatId` 参数的链接：`/chat?chatId={roomId}`

### 发送消息
1. 在文本框中输入消息内容
2. 按 Enter 发送（Shift+Enter 换行）
3. 或点击"发送消息"按钮

### 发送文件
1. 点击"选择文件"按钮选择文件
2. 点击"发送文件"按钮上传并发送
3. 接收方可以点击"下载文件"按钮下载

## 国际化配置

所有文本使用 i18n 配置，位于：
- `locales/zh.json` - 中文
- `locales/en.json` - 英文

使用命名空间：`chat.*`

## 状态说明

### 连接状态
- `not-connected`: 未连接
- `connecting`: 连接中
- `connected`: 已连接
- `connect-fail`: 连接失败
- `connect-interupt`: 连接中断

### UI 状态
- 不同连接状态显示不同颜色的状态栏
- 连接成功后显示房间ID和客户端ID
- 未连接时显示房间操作按钮

## 注意事项

1. WebSocket 连接需要正确配置 `NEXT_PUBLIC_WS_URL` 环境变量
2. 文件上传需要后端提供签名URL支持
3. 聊天记录仅在客户端保存，刷新页面会清空
4. 房间ID需要妥善保管，任何知道ID的人都可以加入

## 开发调试

```bash
# 启动开发服务器
yarn dev

# 访问聊天室页面
http://localhost:3000/chat

# 带房间ID访问
http://localhost:3000/chat?chatId=your-room-id
```

## 未来改进方向

- [ ] 添加消息历史记录持久化
- [ ] 支持图片预览
- [ ] 添加在线用户列表
- [ ] 支持更多文件类型预览
- [ ] 添加消息已读状态
- [ ] 支持消息撤回
- [ ] 添加表情支持
